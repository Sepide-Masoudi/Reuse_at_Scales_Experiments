apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: evaluation-only-
  namespace: no-reuse-pipeline
spec:
  entrypoint: evaluation-only
  serviceAccountName: argo-workflow-sa
  volumes:
    - name: shared-data
      persistentVolumeClaim:
        claimName: argo-shard-pvc
    - name: temp-volume
      emptyDir:
        sizeLimit: 1Gi

  templates:
  - name: evaluation-only
    steps:
    - - name: load-data
        template: load-data-evaluation-only
    - - name: data-quality
        template: data-quality-evaluation-only
    - - name: privacy-tracking
        template: privacy-tracking-evaluation-only

  - name: load-data-evaluation-only
    container:
      image: sepidmas/noreuse_scale-load-data:latest
      command: ["python","main.py"]
      args: ["--input_dir","/app/data/input","--output_dir","/mnt/data/argo-shard/evaluation-only-load-data"]
      env:
        - name: TMPDIR
          value: /tmp
        - name: TEMP
          value: /tmp
        - name: TMP
          value: /tmp

      resources:
        requests:
          cpu: "100m"
          memory: "256Mi"
          ephemeral-storage: "200Mi"
        limits:
          cpu: "500m"
          memory: "512Mi"
          ephemeral-storage: "500Mi"

      volumeMounts:
        - name: shared-data
          mountPath: /mnt/data/argo-shard
        - name: temp-volume
          mountPath: /tmp
  - name: data-quality-evaluation-only
    container:
      image: sepidmas/noreuse_scale-data-quality:latest
      command: ["python","main.py"]
      args: ["--metadata_path","/mnt/data/argo-shard/evaluation-only-load-data/meta-data.json","--real_data_path","/mnt/data/argo-shard/evaluation-only-load-data/real-data.csv","--synthetic_data_path","/mnt/data/argo-shard/evaluation-only-load-data/synthetic-data.csv","--output_path","/mnt/data/argo-shard/evaluation-only-data-quality/quality_report.json","--method","realistic","--output_dir","/mnt/data/argo-shard/evaluation-only-data-quality/quality_report_HTML.html"]      
      env:
      - name: TMPDIR
        value: /tmp
      - name: TEMP
        value: /tmp
      - name: TMP
        value: /tmp
      resources:
            requests:
              cpu: "100m"
              memory: "256Mi"
              ephemeral-storage: "100Mi"
            limits:
              cpu: "500m"
              memory: "512Mi"
              ephemeral-storage: "200Mi"      
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data/argo-shard
      - name: shared-data
        mountPath: /tmp
        subPath: tmp

  - name: privacy-tracking-evaluation-only
    container:
      image: sepidmas/noreuse_scale-privacy-tracking:latest
      command: ["python","main.py"]
      args: ["--real_data_path","/mnt/data/argo-shard/evaluation-only-load-data/real-data.csv","--synthetic_data_path","/mnt/data/argo-shard/evaluation-only-load-data/synthetic-data.csv","--output_path","/mnt/data/argo-shard/evaluation-only-privacy-tracking/privacy_report.json"]
      env:
      - name: TMPDIR
        value: /tmp
      - name: TEMP
        value: /tmp
      - name: TMP
        value: /tmp
      resources:
            requests:
              cpu: "100m"
              memory: "256Mi"
              ephemeral-storage: "100Mi"
            limits:
              cpu: "500m"
              memory: "512Mi"
              ephemeral-storage: "200Mi"      
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data/argo-shard
      - name: shared-data
        mountPath: /tmp
        subPath: tmp  