apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: synthesize-only-
  namespace: pipeline
spec:
  entrypoint: synthesize-only
  serviceAccountName: argo-workflow-sa
  volumes:
  - name: shared-data
    persistentVolumeClaim:
      claimName: argo-shard-pvc
  templates:
  - name: synthesize-only
    steps:
    - - name: load-data
        template: call-load-data-service
    - - name: synthetic-generator
        template: call-synthetic-generator-service
  - name: call-load-data-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://load-data.pipeline.svc.cluster.local:8092/run
      - -F
      - input_dir=/app/data/input
      - -F
      - output_dir=/mnt/data/argo-shard/synthesize-only-load-data
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data
  - name: call-synthetic-generator-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://synthetic-generator.pipeline.svc.cluster.local:8090/run
      - -F
      - metadata_json=/mnt/data/argo-shard/synthesize-only-load-data/meta-data.json
      - -F
      - input_csv=real-data.csv
      - -F
      - input_dir=/mnt/data/argo-shard/synthesize-only-load-data
      - -F
      - output_file=/mnt/data/argo-shard/fsynthesize-only-synthetic-generator/synthetic_data.csv
      - -F
      - n_rows=100
      - -F
      - method=realistic
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data