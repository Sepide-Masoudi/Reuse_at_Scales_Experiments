# in synthetic, combine the input dir and input path.
# in privacy , combiine the input dir and input path.
# data quality redeploy
apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: parallel-full-data-generation-and-evaluation-
  namespace: pipeline
spec:
  entrypoint: parallel-full-data-generation-and-evaluation
  serviceAccountName: argo-workflow-sa
  volumes:
  - name: shared-data
    persistentVolumeClaim:
      claimName: argo-shard-pvc
  templates:
  - name: parallel-full-data-generation-and-evaluation
    steps:
    - - name: generate-name
        template: call-generate-name-service
      - name: generate-birthday
        template: call-generate-birthday-service
      - name: generate-address
        template: call-generate-address-service
    - - name: generate-id
        template: call-generate-id-service
    - - name: data-preprocess
        template: call-data-preprocess-service
    - - name: synthetic-generator
        template: call-synthetic-generator-service
    - - name: privacy-tracking
        template: call-privacy-tracking-service
      - name: data-quality
        template: call-data-quality-service
  - name: call-generate-name-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://generate-name.pipeline.svc.cluster.local:8082/run
      - -F
      - n_rows=100
      - -F
      - mf_ratio=0.5
      - -F
      - output_path=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-generate-name/names.csv
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data
  - name: call-generate-birthday-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://generate-birthday.pipeline.svc.cluster.local:8086/run
      - -F
      - n_rows=100
      - -F
      - min_age=18
      - -F
      - max_age=80
      - -F
      - output_file=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-generate-birthday/birthdays.csv
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data
  - name: call-generate-address-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://generate-address.pipeline.svc.cluster.local:8085/run
      - -F
      - n_rows=100
      - -F
      - output_file=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-generate-address/addresses.csv
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data
  - name: call-generate-id-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://generate-id.pipeline.svc.cluster.local:8087/run
      - -F
      - name_csv=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-generate-name/names.csv
      - -F
      - birthday_csv=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-generate-birthday/birthdays.csv
      - -F
      - output_file=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-generate-id/id_data.csv
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data
  - name: call-data-preprocess-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://data-preprocess.pipeline.svc.cluster.local:8083/run
      - -F
      - metadata_file=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-data-preprocess/metadata.json
      - -F
      - input_file=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-generate-id/id_data.csv
      - -F
      - output_file=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-data-preprocess/clean_data.csv
      - -F
      - handle_missing=mean
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data
  - name: call-synthetic-generator-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://synthetic-generator.pipeline.svc.cluster.local:8090/run
      - -F
      - metadata_json=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-data-preprocess/metadata.json
      - -F
      - input_csv=clean_data.csv
      - -F
      - input_dir=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-data-preprocess
      - -F
      - output_file=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-synthetic-generator/synthetic_data.csv
      - -F
      - n_rows=100
      - -F
      - method=realistic
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data
  - name: call-data-quality-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://data-quality.pipeline.svc.cluster.local:8084/run
      - -F
      - input_metadata_file=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-data-preprocess/metadata.json
      - -F
      - input_file_real=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-data-preprocess/clean_data.csv
      - -F
      - input_file_synth=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-synthetic-generator/synthetic_data.csv
      - -F
      - output_dir=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-data-quality
      - -F
      - metrics=realistic
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data
  - name: call-privacy-tracking-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://privacy-tracking.pipeline.svc.cluster.local:8089/run
      - -F
      - input_dir=/mnt/data/argo-shard
      - -F
      - real_csv=parallel-full-data-generation-and-evaluation-data-preprocess/clean_data.csv
      - -F
      - synth_csv=parallel-full-data-generation-and-evaluation-synthetic-generator/synthetic_data.csv
      - -F
      - output_file=/mnt/data/argo-shard/parallel-full-data-generation-and-evaluation-privacy-tracking/privacy_report.json
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data