apiVersion: argoproj.io/v1alpha1
kind: Workflow
metadata:
  generateName: evaluation-only-
  namespace: pipeline
spec:
  entrypoint: evaluation-only
  serviceAccountName: argo-workflow-sa
  volumes:
  - name: shared-data
    persistentVolumeClaim:
      claimName: argo-shard-pvc
  templates:
  - name: evaluation-only
    steps:
    - - name: load-real-data
        template: call-load-real-data-service
    - - name: privacy-tracking
        template: call-privacy-tracking-service
    - - name: data-quality
        template: call-data-quality-service        
  - name: call-load-real-data-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://load-data.pipeline.svc.cluster.local:8092/run
      - -F
      - input_dir=/app/data/input
      - -F
      - output_dir=/mnt/data/argo-shard/evaluation-only-load-data
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data
  - name: call-data-quality-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://data-quality.pipeline.svc.cluster.local:8084/run
      - -F
      - input_metadata_file=/mnt/data/argo-shard/evaluation-only-load-data/meta-data.json
      - -F
      - input_file_real=/mnt/data/argo-shard/evaluation-only-load-data/real-data.csv
      - -F
      - input_file_synth=/mnt/data/argo-shard/evaluation-only-load-data/synthetic-data.csv
      - -F
      - output_dir=/mnt/data/argo-shard/evaluation-only-data-quality
      - -F
      - metrics=realistic
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data
  - name: call-privacy-tracking-service
    container:
      image: curlimages/curl:7.85.0
      command:
      - curl
      - -X
      - POST
      - http://privacy-tracking.pipeline.svc.cluster.local:8089/run
      - -F
      - input_dir=/mnt/data/argo-shard
      - -F
      - real_csv=evaluation-only-load-data/real-data.csv
      - -F
      - synth_csv=evaluation-only-load-data/synthetic-data.csv
      - -F
      - output_file=/mnt/data/argo-shard/evaluation-only-privacy-tracking/privacy_report.json
      volumeMounts:
      - name: shared-data
        mountPath: /mnt/data