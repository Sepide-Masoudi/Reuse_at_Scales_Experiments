sma:
  version: 0.0.1
  services:
    prometheus:
      address: http://130.149.158.132:32426
  observation:
    mode: trigger
    window:
      left: 10s
      right: 10s
    targets:
      - name: reuse
        namespace: pipeline
      - name: no-reuse
        namespace: no-reuse-pipeline  
  measurements:
    - system_CPU:
        type: raw
        query: container_cpu_usage_seconds_total{namespace="${namespace}"}
        step: 30
        unit: cpu_time_seconds
        target: 
          - sut
    - wall_power:
        type: raw
        query: shelly_apower_watts
        unit: watts
        step: 30
        target:
          - all
    - pod_power_consumption_kepler_watts:
        type: aggregate
        layer: pod
        query: sum by (pod_name) (rate(kepler_container_joules_total{container_namespace="${namespace}"}[1m]))
        unit: watts
        step: 30
        target:
          - sut
    - node_power_consumption_scaphandre:
        type: raw
        layer: node
        unit: watts
        query: scaph_host_power_microwatts / 1e6
        step: 30
        target:
          - all
    - node_power_consumption_kepler:
        type: aggregate
        layer: node
        query: sum by (node) (rate(kepler_node_cpu_joules_total[1m]))
        unit: watts
        step: 30
        target:
          - sut
    - process_power_consumption:
        type: raw
        layer: pod
        query: kepler_process_joules_total{container_namespace="${namespace}"}
        unit: joules
        step: 30
        target:
          - sut
  report:
    format: csv
    location: data/
    filename: "${experiment}/${startTime}_${runHash}/${name}_${run}.csv"